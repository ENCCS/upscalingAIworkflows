

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image classifier for the The Street View House Numbers (SVHN) Dataset &mdash; Upscaling AI workflows  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_lesson.css?v=e9df6548" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/overrides.css?v=0572569b" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=187304be"></script>
      <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../_static/minipres.js?v=a0d29692"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script data-domain="enccs.github.io/upscalingAIworkflows" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../" class="icon icon-home">
            Upscaling AI workflows
              <img src="../../../../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../setup/">Access to Vega</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro-container/">Introduction to Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro_docker/">Introduction to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mang_contain/">Cleaning Up Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../create_contain/">Creating your own container images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../compx_contain/">Creating More Complex Container Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../singlrty_start/">What is Singularity?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../work_contain/">Working with Singularity containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../build_contain/">Building Singularity images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tf_intro/">TensorFlow on a single GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tf_mltgpus/">Distributed training in TensorFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hvd_intro/">Intoduction to Horovod</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../train_contain/">Training Neural Networks using Containers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Optional</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../containers/content/mpi_contain/">Running MPI parallel jobs using Singularity containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../containers/content/rep_gran/">Containers in research workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../containers/content/pwd_exmps/">PWD exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../namespc-cgroup/">Namespaces and cgroups</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../">Upscaling AI workflows</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Image classifier for the The Street View House Numbers (SVHN) Dataset</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/upscalingAIworkflows/blob/main/content/upscalingAIcontainer/content/code/SVHN_class.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="image-classifier-for-the-the-street-view-house-numbers-svhn-dataset">
<h1>Image classifier for the The Street View House Numbers (SVHN) Dataset<a class="headerlink" href="#image-classifier-for-the-the-street-view-house-numbers-svhn-dataset" title="Link to this heading"></a></h1>
<p>In this notebook, you will use a neural network that classifies real-world images digits. You
will use concepts from throughout this course to run different part of model on either CPU or GPU and compare the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">loadmat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">loadmat</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;tensorflow&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>http://ufldl.stanford.edu/housenumbers/train_32x32.mat
<span class="o">!</span>wget<span class="w"> </span>http://ufldl.stanford.edu/housenumbers/test_32x32.mat
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2022-01-30 15:58:24--  http://ufldl.stanford.edu/housenumbers/train_32x32.mat
Resolving ufldl.stanford.edu (ufldl.stanford.edu)... 171.64.68.10
Connecting to ufldl.stanford.edu (ufldl.stanford.edu)|171.64.68.10|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 182040794 (174M) [text/plain]
Saving to: ‘train_32x32.mat.3’

100%[======================================&gt;] 182,040,794 15.1MB/s   in 16s    

2022-01-30 15:58:41 (10.6 MB/s) - ‘train_32x32.mat.3’ saved [182040794/182040794]

--2022-01-30 15:58:41--  http://ufldl.stanford.edu/housenumbers/test_32x32.mat
Resolving ufldl.stanford.edu (ufldl.stanford.edu)... 171.64.68.10
Connecting to ufldl.stanford.edu (ufldl.stanford.edu)|171.64.68.10|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 64275384 (61M) [text/plain]
Saving to: ‘test_32x32.mat.3’

100%[======================================&gt;] 64,275,384  14.2MB/s   in 9.3s   

2022-01-30 15:58:50 (6.58 MB/s) - ‘test_32x32.mat.3’ saved [64275384/64275384]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;train_32x32.mat&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;test_32x32.mat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">load_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.layers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span><span class="p">,</span> <span class="n">BatchNormalization</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras.callbacks</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span><span class="p">,</span> <span class="n">EarlyStopping</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

<span class="n">x_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_plts</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_plts</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">num_plts</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">im_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">num_plts</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">im_set</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_train</span><span class="p">[:,:,:,</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-7-eea9e1d3e61f&gt;:3: DeprecationWarning: This function is deprecated. Please call randint(1, 73257 + 1) instead
  im_set = np.random.random_integers(1, x_train.shape[3], num_plts)
</pre></div>
</div>
<img alt="../../../../_images/4686904432253d8f175c3cf413b3e5763d6935666e57b1301901cec1525f9567.png" src="../../../../_images/4686904432253d8f175c3cf413b3e5763d6935666e57b1301901cec1525f9567.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train_gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_train_gs</span> <span class="o">=</span> <span class="n">x_train_gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">x_test_gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x_test_gs</span> <span class="o">=</span> <span class="n">x_test_gs</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_plts</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">num_plts</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">im_set</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_train_gs</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">],:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/6ebc8432cfc9d5f2fd824d5b4042cfd43c69133ee519478a44bcb7d2fe4df805.png" src="../../../../_images/6ebc8432cfc9d5f2fd824d5b4042cfd43c69133ee519478a44bcb7d2fe4df805.png" />
</div>
</div>
<section id="mlp-neural-network-classi">
<h2>MLP neural network classi<a class="headerlink" href="#mlp-neural-network-classi" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_model</span><span class="p">(</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">,</span> <span class="n">nn_units</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">),</span>
                        <span class="n">Dense</span><span class="p">(</span><span class="n">nn_units</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
                        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>
                        <span class="n">Dense</span><span class="p">(</span><span class="n">nn_units</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
                        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>
                        <span class="n">Dense</span><span class="p">(</span><span class="n">nn_units</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
                        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>
                        <span class="n">Dense</span><span class="p">(</span><span class="n">nn_units</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
                        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>
                        <span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;softmax&#39;</span><span class="p">)])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_mlp</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">x_train_gs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_mlp</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
flatten (Flatten)            (None, 1024)              0         
_________________________________________________________________
dense (Dense)                (None, 64)                65600     
_________________________________________________________________
dropout (Dropout)            (None, 64)                0         
_________________________________________________________________
dense_1 (Dense)              (None, 64)                4160      
_________________________________________________________________
dropout_1 (Dropout)          (None, 64)                0         
_________________________________________________________________
dense_2 (Dense)              (None, 64)                4160      
_________________________________________________________________
dropout_2 (Dropout)          (None, 64)                0         
_________________________________________________________________
dense_3 (Dense)              (None, 64)                4160      
_________________________________________________________________
dropout_3 (Dropout)          (None, 64)                0         
_________________________________________________________________
dense_4 (Dense)              (None, 10)                650       
=================================================================
Total params: 78,730
Trainable params: 78,730
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">checkpoint_best_path</span> <span class="o">=</span> <span class="s1">&#39;mlp_chkpnts_bst/chkpnt&#39;</span>
<span class="n">checkpoint_best</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">checkpoint_best_path</span><span class="p">,</span> <span class="n">save_weights_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">save_best_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">earlystop</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">patience</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">64</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">history_mlp</span> <span class="o">=</span> <span class="n">model_mlp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_gs</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> 
                        <span class="n">validation_split</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">checkpoint_best</span><span class="p">,</span> <span class="n">earlystop</span><span class="p">])</span>
<span class="n">endt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time for </span><span class="si">{}</span><span class="s2"> epochs: </span><span class="si">{:0.2f}</span><span class="s2">ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span><span class="mi">1000</span><span class="o">*</span><span class="n">endt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/32
487/487 [==============================] - 3s 4ms/step - loss: 2.0275 - accuracy: 0.2860 - val_loss: 1.6855 - val_accuracy: 0.4246

Epoch 00001: val_accuracy improved from -inf to 0.42461, saving model to mlp_chkpnts_bst/chkpnt
Epoch 2/32
487/487 [==============================] - 2s 3ms/step - loss: 1.4256 - accuracy: 0.5258 - val_loss: 1.2767 - val_accuracy: 0.5843

Epoch 00002: val_accuracy improved from 0.42461 to 0.58431, saving model to mlp_chkpnts_bst/chkpnt
Epoch 3/32
487/487 [==============================] - 2s 3ms/step - loss: 1.1960 - accuracy: 0.6162 - val_loss: 1.1506 - val_accuracy: 0.6343

Epoch 00003: val_accuracy improved from 0.58431 to 0.63427, saving model to mlp_chkpnts_bst/chkpnt
Epoch 4/32
487/487 [==============================] - 2s 3ms/step - loss: 1.1088 - accuracy: 0.6508 - val_loss: 1.1331 - val_accuracy: 0.6373

Epoch 00004: val_accuracy improved from 0.63427 to 0.63727, saving model to mlp_chkpnts_bst/chkpnt
Epoch 5/32
487/487 [==============================] - 2s 3ms/step - loss: 1.0540 - accuracy: 0.6697 - val_loss: 1.0346 - val_accuracy: 0.6711

Epoch 00005: val_accuracy improved from 0.63727 to 0.67113, saving model to mlp_chkpnts_bst/chkpnt
Epoch 6/32
487/487 [==============================] - 2s 3ms/step - loss: 0.9972 - accuracy: 0.6907 - val_loss: 0.9705 - val_accuracy: 0.6938

Epoch 00006: val_accuracy improved from 0.67113 to 0.69378, saving model to mlp_chkpnts_bst/chkpnt
Epoch 7/32
487/487 [==============================] - 2s 3ms/step - loss: 0.9510 - accuracy: 0.7046 - val_loss: 0.9991 - val_accuracy: 0.6819

Epoch 00007: val_accuracy did not improve from 0.69378
Epoch 8/32
487/487 [==============================] - 1s 2ms/step - loss: 0.9164 - accuracy: 0.7154 - val_loss: 0.9410 - val_accuracy: 0.7021

Epoch 00008: val_accuracy improved from 0.69378 to 0.70207, saving model to mlp_chkpnts_bst/chkpnt
Epoch 9/32
487/487 [==============================] - 2s 3ms/step - loss: 0.8889 - accuracy: 0.7244 - val_loss: 0.8663 - val_accuracy: 0.7265

Epoch 00009: val_accuracy improved from 0.70207 to 0.72654, saving model to mlp_chkpnts_bst/chkpnt
Epoch 10/32
487/487 [==============================] - 2s 3ms/step - loss: 0.8705 - accuracy: 0.7290 - val_loss: 0.9407 - val_accuracy: 0.7037

Epoch 00010: val_accuracy did not improve from 0.72654
Epoch 11/32
487/487 [==============================] - 1s 3ms/step - loss: 0.8502 - accuracy: 0.7358 - val_loss: 0.8658 - val_accuracy: 0.7250

Epoch 00011: val_accuracy did not improve from 0.72654
Epoch 12/32
487/487 [==============================] - 1s 3ms/step - loss: 0.8262 - accuracy: 0.7428 - val_loss: 0.9319 - val_accuracy: 0.7014

Epoch 00012: val_accuracy did not improve from 0.72654
Epoch 13/32
487/487 [==============================] - 1s 2ms/step - loss: 0.8152 - accuracy: 0.7450 - val_loss: 0.8316 - val_accuracy: 0.7357

Epoch 00013: val_accuracy improved from 0.72654 to 0.73574, saving model to mlp_chkpnts_bst/chkpnt
Epoch 14/32
487/487 [==============================] - 2s 3ms/step - loss: 0.7928 - accuracy: 0.7528 - val_loss: 0.8131 - val_accuracy: 0.7415

Epoch 00014: val_accuracy improved from 0.73574 to 0.74147, saving model to mlp_chkpnts_bst/chkpnt
Epoch 15/32
487/487 [==============================] - 1s 3ms/step - loss: 0.7891 - accuracy: 0.7519 - val_loss: 0.7754 - val_accuracy: 0.7563

Epoch 00015: val_accuracy improved from 0.74147 to 0.75630, saving model to mlp_chkpnts_bst/chkpnt
Epoch 16/32
487/487 [==============================] - 2s 3ms/step - loss: 0.7740 - accuracy: 0.7575 - val_loss: 0.8660 - val_accuracy: 0.7306

Epoch 00016: val_accuracy did not improve from 0.75630
Epoch 17/32
487/487 [==============================] - 1s 3ms/step - loss: 0.7540 - accuracy: 0.7651 - val_loss: 0.8394 - val_accuracy: 0.7301

Epoch 00017: val_accuracy did not improve from 0.75630
Epoch 18/32
487/487 [==============================] - 1s 3ms/step - loss: 0.7508 - accuracy: 0.7655 - val_loss: 0.8099 - val_accuracy: 0.7453

Epoch 00018: val_accuracy did not improve from 0.75630
Epoch 19/32
487/487 [==============================] - 1s 3ms/step - loss: 0.7313 - accuracy: 0.7714 - val_loss: 0.8126 - val_accuracy: 0.7445

Epoch 00019: val_accuracy did not improve from 0.75630
Epoch 20/32
487/487 [==============================] - 1s 3ms/step - loss: 0.7237 - accuracy: 0.7728 - val_loss: 0.7536 - val_accuracy: 0.7615

Epoch 00020: val_accuracy improved from 0.75630 to 0.76149, saving model to mlp_chkpnts_bst/chkpnt
Epoch 21/32
487/487 [==============================] - 2s 3ms/step - loss: 0.7111 - accuracy: 0.7777 - val_loss: 0.7429 - val_accuracy: 0.7655

Epoch 00021: val_accuracy improved from 0.76149 to 0.76549, saving model to mlp_chkpnts_bst/chkpnt
Epoch 22/32
487/487 [==============================] - 2s 3ms/step - loss: 0.7034 - accuracy: 0.7800 - val_loss: 0.7212 - val_accuracy: 0.7756

Epoch 00022: val_accuracy improved from 0.76549 to 0.77559, saving model to mlp_chkpnts_bst/chkpnt
Epoch 23/32
487/487 [==============================] - 2s 3ms/step - loss: 0.7007 - accuracy: 0.7811 - val_loss: 0.7422 - val_accuracy: 0.7654

Epoch 00023: val_accuracy did not improve from 0.77559
Epoch 24/32
487/487 [==============================] - 1s 2ms/step - loss: 0.6890 - accuracy: 0.7842 - val_loss: 0.7501 - val_accuracy: 0.7604

Epoch 00024: val_accuracy did not improve from 0.77559
Epoch 25/32
487/487 [==============================] - 1s 2ms/step - loss: 0.6766 - accuracy: 0.7877 - val_loss: 0.7457 - val_accuracy: 0.7669

Epoch 00025: val_accuracy did not improve from 0.77559
Epoch 26/32
487/487 [==============================] - 1s 3ms/step - loss: 0.6702 - accuracy: 0.7898 - val_loss: 0.7230 - val_accuracy: 0.7746

Epoch 00026: val_accuracy did not improve from 0.77559
Epoch 27/32
487/487 [==============================] - 2s 3ms/step - loss: 0.6650 - accuracy: 0.7930 - val_loss: 0.7561 - val_accuracy: 0.7630

Epoch 00027: val_accuracy did not improve from 0.77559
Epoch 28/32
487/487 [==============================] - 2s 3ms/step - loss: 0.6728 - accuracy: 0.7877 - val_loss: 0.7246 - val_accuracy: 0.7741

Epoch 00028: val_accuracy did not improve from 0.77559
Epoch 29/32
487/487 [==============================] - 2s 3ms/step - loss: 0.6571 - accuracy: 0.7945 - val_loss: 0.7473 - val_accuracy: 0.7680

Epoch 00029: val_accuracy did not improve from 0.77559
Epoch 30/32
487/487 [==============================] - 2s 3ms/step - loss: 0.6480 - accuracy: 0.7959 - val_loss: 0.6907 - val_accuracy: 0.7844

Epoch 00030: val_accuracy improved from 0.77559 to 0.78442, saving model to mlp_chkpnts_bst/chkpnt
Epoch 31/32
487/487 [==============================] - 2s 3ms/step - loss: 0.6411 - accuracy: 0.7992 - val_loss: 0.6842 - val_accuracy: 0.7874

Epoch 00031: val_accuracy improved from 0.78442 to 0.78742, saving model to mlp_chkpnts_bst/chkpnt
Epoch 32/32
487/487 [==============================] - 2s 3ms/step - loss: 0.6410 - accuracy: 0.7976 - val_loss: 0.7157 - val_accuracy: 0.7764

Epoch 00032: val_accuracy did not improve from 0.78742
Time for 32 epochs: 50671.81ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_mlp</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_mlp</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Loss vs. epochs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Training&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/e80dd39de278c02eec87803d7a7095bf9e83aa76ac8e12b7ee9d5bd0f9267a8d.png" src="../../../../_images/e80dd39de278c02eec87803d7a7095bf9e83aa76ac8e12b7ee9d5bd0f9267a8d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_mlp</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_mlp</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Accuracy vs. epochs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Training&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/3ede3a124fe9a22893f85260efe0e668e4b4f5d5ef02f500cb8ab9712d7e0afa.png" src="../../../../_images/3ede3a124fe9a22893f85260efe0e668e4b4f5d5ef02f500cb8ab9712d7e0afa.png" />
</div>
</div>
</section>
<section id="cnn-neural-network-classifier">
<h2>CNN neural network classifier<a class="headerlink" href="#cnn-neural-network-classifier" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_model_cnn</span><span class="p">(</span><span class="n">input_shape</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">,</span> <span class="n">nn_units</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
        <span class="n">Conv2D</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">padding</span> <span class="o">=</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">,</span> <span class="n">input_shape</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">),</span>
        <span class="n">MaxPooling2D</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span>
        <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">padding</span> <span class="o">=</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
        <span class="n">MaxPooling2D</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span>
        <span class="n">Flatten</span><span class="p">(),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="n">nn_units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="n">nn_units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s1">&#39;he_uniform&#39;</span><span class="p">),</span>
        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>
        <span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">),</span>
    <span class="p">])</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_cnn</span> <span class="o">=</span> <span class="n">get_model_cnn</span><span class="p">(</span><span class="n">x_train_gs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_cnn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential_1&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 32, 32, 8)         80        
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 10, 10, 8)         0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 10, 10, 16)        1168      
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 3, 3, 16)          0         
_________________________________________________________________
flatten_1 (Flatten)          (None, 144)               0         
_________________________________________________________________
dense_5 (Dense)              (None, 64)                9280      
_________________________________________________________________
dropout_4 (Dropout)          (None, 64)                0         
_________________________________________________________________
dense_6 (Dense)              (None, 64)                4160      
_________________________________________________________________
dropout_5 (Dropout)          (None, 64)                0         
_________________________________________________________________
dense_7 (Dense)              (None, 10)                650       
=================================================================
Total params: 15,338
Trainable params: 15,338
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">checkpoint_best_path</span> <span class="o">=</span> <span class="s1">&#39;cnn_chkpnts_bst/chkpnt&#39;</span>
<span class="n">checkpoint_best</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">checkpoint_best_path</span><span class="p">,</span> <span class="n">save_weights_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">save_best_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">earlystop</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">patience</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">history_cnn</span> <span class="o">=</span> <span class="n">model_cnn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_gs</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> 
                    <span class="n">validation_split</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">checkpoint_best</span><span class="p">,</span> <span class="n">earlystop</span><span class="p">])</span>
<span class="n">endt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time for </span><span class="si">{}</span><span class="s2"> epochs: </span><span class="si">{:0.2f}</span><span class="s2">ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span><span class="mi">1000</span><span class="o">*</span><span class="n">endt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/32
487/487 [==============================] - 5s 6ms/step - loss: 2.1898 - accuracy: 0.2108 - val_loss: 1.9989 - val_accuracy: 0.2845

Epoch 00001: val_accuracy improved from -inf to 0.28447, saving model to cnn_chkpnts_bst/chkpnt
Epoch 2/32
487/487 [==============================] - 2s 5ms/step - loss: 1.9080 - accuracy: 0.3317 - val_loss: 1.5927 - val_accuracy: 0.4672

Epoch 00002: val_accuracy improved from 0.28447 to 0.46719, saving model to cnn_chkpnts_bst/chkpnt
Epoch 3/32
487/487 [==============================] - 2s 5ms/step - loss: 1.6040 - accuracy: 0.4485 - val_loss: 1.2874 - val_accuracy: 0.5742

Epoch 00003: val_accuracy improved from 0.46719 to 0.57421, saving model to cnn_chkpnts_bst/chkpnt
Epoch 4/32
487/487 [==============================] - 2s 5ms/step - loss: 1.3819 - accuracy: 0.5304 - val_loss: 1.0964 - val_accuracy: 0.6496

Epoch 00004: val_accuracy improved from 0.57421 to 0.64956, saving model to cnn_chkpnts_bst/chkpnt
Epoch 5/32
487/487 [==============================] - 2s 5ms/step - loss: 1.2381 - accuracy: 0.5850 - val_loss: 0.9567 - val_accuracy: 0.6966

Epoch 00005: val_accuracy improved from 0.64956 to 0.69661, saving model to cnn_chkpnts_bst/chkpnt
Epoch 6/32
487/487 [==============================] - 2s 5ms/step - loss: 1.1499 - accuracy: 0.6197 - val_loss: 0.8914 - val_accuracy: 0.7195

Epoch 00006: val_accuracy improved from 0.69661 to 0.71954, saving model to cnn_chkpnts_bst/chkpnt
Epoch 7/32
487/487 [==============================] - 2s 5ms/step - loss: 1.0900 - accuracy: 0.6413 - val_loss: 0.8318 - val_accuracy: 0.7421

Epoch 00007: val_accuracy improved from 0.71954 to 0.74211, saving model to cnn_chkpnts_bst/chkpnt
Epoch 8/32
487/487 [==============================] - 2s 5ms/step - loss: 1.0440 - accuracy: 0.6611 - val_loss: 0.8039 - val_accuracy: 0.7528

Epoch 00008: val_accuracy improved from 0.74211 to 0.75284, saving model to cnn_chkpnts_bst/chkpnt
Epoch 9/32
487/487 [==============================] - 2s 4ms/step - loss: 1.0184 - accuracy: 0.6719 - val_loss: 0.7730 - val_accuracy: 0.7579

Epoch 00009: val_accuracy improved from 0.75284 to 0.75794, saving model to cnn_chkpnts_bst/chkpnt
Epoch 10/32
487/487 [==============================] - 2s 5ms/step - loss: 0.9868 - accuracy: 0.6810 - val_loss: 0.7470 - val_accuracy: 0.7700

Epoch 00010: val_accuracy improved from 0.75794 to 0.77004, saving model to cnn_chkpnts_bst/chkpnt
Epoch 11/32
487/487 [==============================] - 3s 5ms/step - loss: 0.9665 - accuracy: 0.6924 - val_loss: 0.7454 - val_accuracy: 0.7692

Epoch 00011: val_accuracy did not improve from 0.77004
Epoch 12/32
487/487 [==============================] - 2s 5ms/step - loss: 0.9510 - accuracy: 0.6982 - val_loss: 0.7253 - val_accuracy: 0.7775

Epoch 00012: val_accuracy improved from 0.77004 to 0.77750, saving model to cnn_chkpnts_bst/chkpnt
Epoch 13/32
487/487 [==============================] - 2s 5ms/step - loss: 0.9382 - accuracy: 0.7035 - val_loss: 0.7004 - val_accuracy: 0.7855

Epoch 00013: val_accuracy improved from 0.77750 to 0.78551, saving model to cnn_chkpnts_bst/chkpnt
Epoch 14/32
487/487 [==============================] - 2s 5ms/step - loss: 0.9211 - accuracy: 0.7078 - val_loss: 0.6929 - val_accuracy: 0.7886

Epoch 00014: val_accuracy improved from 0.78551 to 0.78861, saving model to cnn_chkpnts_bst/chkpnt
Epoch 15/32
487/487 [==============================] - 2s 4ms/step - loss: 0.9079 - accuracy: 0.7126 - val_loss: 0.6861 - val_accuracy: 0.7851

Epoch 00015: val_accuracy did not improve from 0.78861
Epoch 16/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8997 - accuracy: 0.7189 - val_loss: 0.6937 - val_accuracy: 0.7821

Epoch 00016: val_accuracy did not improve from 0.78861
Epoch 17/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8903 - accuracy: 0.7216 - val_loss: 0.6924 - val_accuracy: 0.7866

Epoch 00017: val_accuracy did not improve from 0.78861
Epoch 18/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8782 - accuracy: 0.7261 - val_loss: 0.6669 - val_accuracy: 0.7964

Epoch 00018: val_accuracy improved from 0.78861 to 0.79643, saving model to cnn_chkpnts_bst/chkpnt
Epoch 19/32
487/487 [==============================] - 3s 5ms/step - loss: 0.8652 - accuracy: 0.7310 - val_loss: 0.6503 - val_accuracy: 0.8015

Epoch 00019: val_accuracy improved from 0.79643 to 0.80153, saving model to cnn_chkpnts_bst/chkpnt
Epoch 20/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8586 - accuracy: 0.7345 - val_loss: 0.6447 - val_accuracy: 0.8030

Epoch 00020: val_accuracy improved from 0.80153 to 0.80298, saving model to cnn_chkpnts_bst/chkpnt
Epoch 21/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8487 - accuracy: 0.7375 - val_loss: 0.6441 - val_accuracy: 0.8013

Epoch 00021: val_accuracy did not improve from 0.80298
Epoch 22/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8370 - accuracy: 0.7419 - val_loss: 0.6423 - val_accuracy: 0.7985

Epoch 00022: val_accuracy did not improve from 0.80298
Epoch 23/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8418 - accuracy: 0.7402 - val_loss: 0.6304 - val_accuracy: 0.8050

Epoch 00023: val_accuracy improved from 0.80298 to 0.80499, saving model to cnn_chkpnts_bst/chkpnt
Epoch 24/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8343 - accuracy: 0.7433 - val_loss: 0.6356 - val_accuracy: 0.8053

Epoch 00024: val_accuracy improved from 0.80499 to 0.80526, saving model to cnn_chkpnts_bst/chkpnt
Epoch 25/32
487/487 [==============================] - 2s 4ms/step - loss: 0.8237 - accuracy: 0.7466 - val_loss: 0.6377 - val_accuracy: 0.8042

Epoch 00025: val_accuracy did not improve from 0.80526
Epoch 26/32
487/487 [==============================] - 3s 5ms/step - loss: 0.8176 - accuracy: 0.7489 - val_loss: 0.6151 - val_accuracy: 0.8079

Epoch 00026: val_accuracy improved from 0.80526 to 0.80790, saving model to cnn_chkpnts_bst/chkpnt
Epoch 27/32
487/487 [==============================] - 3s 5ms/step - loss: 0.8202 - accuracy: 0.7504 - val_loss: 0.6305 - val_accuracy: 0.8055

Epoch 00027: val_accuracy did not improve from 0.80790
Epoch 28/32
487/487 [==============================] - 3s 5ms/step - loss: 0.8128 - accuracy: 0.7536 - val_loss: 0.6098 - val_accuracy: 0.8114

Epoch 00028: val_accuracy improved from 0.80790 to 0.81145, saving model to cnn_chkpnts_bst/chkpnt
Epoch 29/32
487/487 [==============================] - 2s 5ms/step - loss: 0.8075 - accuracy: 0.7575 - val_loss: 0.6249 - val_accuracy: 0.8113

Epoch 00029: val_accuracy did not improve from 0.81145
Epoch 30/32
487/487 [==============================] - 2s 5ms/step - loss: 0.7944 - accuracy: 0.7598 - val_loss: 0.6125 - val_accuracy: 0.8105

Epoch 00030: val_accuracy did not improve from 0.81145
Epoch 31/32
487/487 [==============================] - 2s 5ms/step - loss: 0.7965 - accuracy: 0.7600 - val_loss: 0.6177 - val_accuracy: 0.8137

Epoch 00031: val_accuracy improved from 0.81145 to 0.81372, saving model to cnn_chkpnts_bst/chkpnt
Epoch 32/32
487/487 [==============================] - 2s 4ms/step - loss: 0.7877 - accuracy: 0.7611 - val_loss: 0.6186 - val_accuracy: 0.8129

Epoch 00032: val_accuracy did not improve from 0.81372
Time for 32 epochs: 80914.55ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_cnn</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_cnn</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Loss vs. epochs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Training&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/78d2a6a8bb5187c087b59756ae7db51a8cf60dfe538f8cfa09c8ba415d25ec0a.png" src="../../../../_images/78d2a6a8bb5187c087b59756ae7db51a8cf60dfe538f8cfa09c8ba415d25ec0a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_cnn</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history_cnn</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Accuracy vs. epochs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Training&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/edc1ca4ceb2cec3d451b49ac1cf7b8513ceca4a60975a08c88aeb0e6f7711b84.png" src="../../../../_images/edc1ca4ceb2cec3d451b49ac1cf7b8513ceca4a60975a08c88aeb0e6f7711b84.png" />
</div>
</div>
</section>
<section id="evaluations">
<h2>Evaluations<a class="headerlink" href="#evaluations" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_cnn</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test_gs</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>814/814 - 1s - loss: 0.6378 - accuracy: 0.8121
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.6377912163734436, 0.8121158480644226]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_mlp</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test_gs</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>814/814 - 1s - loss: 0.8270 - accuracy: 0.7529
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.8269519209861755, 0.7528810501098633]
</pre></div>
</div>
</div>
</div>
</section>
<section id="predictions">
<h2>Predictions<a class="headerlink" href="#predictions" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds_mlp</span> <span class="o">=</span> <span class="n">model_mlp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_gs</span><span class="p">)</span>

<span class="c1">### Predictions from MLP</span>
<span class="n">num_plts</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_plts</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">num_plts</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">im_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_plts</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">im_set</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_test</span><span class="p">[:,:,:,</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;True label: </span><span class="si">{0:1d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">preds_mlp</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">],:])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pred label: </span><span class="si">{0:1d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds_mlp</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">],:])))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-27-ad7f68ec124b&gt;:7: DeprecationWarning: This function is deprecated. Please call randint(1, 26032 + 1) instead
  im_set = np.random.random_integers(1, y_test.shape[0], num_plts)
</pre></div>
</div>
<img alt="../../../../_images/2fa1ca5441a23073216a4e66f1568d74029fdb0e578971342e22e3a438fb3b3c.png" src="../../../../_images/2fa1ca5441a23073216a4e66f1568d74029fdb0e578971342e22e3a438fb3b3c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds_cnn</span> <span class="o">=</span> <span class="n">model_cnn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_gs</span><span class="p">)</span>

<span class="c1">### Predictions from CNN</span>
<span class="n">num_plts</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_plts</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">num_plts</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">im_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_plts</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">im_set</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_test</span><span class="p">[:,:,:,</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;True label: </span><span class="si">{0:1d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">preds_cnn</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">],:])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pred label: </span><span class="si">{0:1d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">preds_cnn</span><span class="p">[</span><span class="n">im_set</span><span class="p">[</span><span class="n">i</span><span class="p">],:])))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-28-1b24431bdb07&gt;:7: DeprecationWarning: This function is deprecated. Please call randint(1, 26032 + 1) instead
  im_set = np.random.random_integers(1, y_test.shape[0], num_plts)
</pre></div>
</div>
<img alt="../../../../_images/05fdcb649c202e59eb2913b4a48b7f15fccd6ce0f39c5950e8f27b1ace6ff1ac.png" src="../../../../_images/05fdcb649c202e59eb2913b4a48b7f15fccd6ce0f39c5950e8f27b1ace6ff1ac.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, ENCCS, and individual contributors..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>